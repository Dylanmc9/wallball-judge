<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>REPCHK</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA basics -->
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="REPCHK">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="./apple-touch-icon.png">

  <style>
    :root{
      --green:#087862;
      --red:rgba(255,90,90,.95);
      --textDim:rgba(255,255,255,.78);
    }

    body{
      margin:0;
      background:#000;
      color:#fff;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;
      overflow:hidden;
    }

    #videoContainer{position:fixed;inset:0;overflow:hidden}
    video,canvas{
      position:absolute;
      inset:0;
      width:100vw;
      height:100vh;
      object-fit:cover;
    }

    /* HUD */
    #hud{
      position:absolute;
      top:calc(12px + env(safe-area-inset-top));
      left:calc(12px + env(safe-area-inset-left));
      right:calc(12px + env(safe-area-inset-right));
      display:flex;
      justify-content:space-between;
      pointer-events:none;
      z-index:20;
    }

    #counters{
      padding:10px 12px;
      border-radius:16px;
      background:rgba(255,255,255,.08);
      backdrop-filter:blur(10px);
      font-weight:700;
    }

    #controls{
      pointer-events:auto;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
      max-width:70vw;
    }

    .glassBtn{
      padding:10px 14px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.08);
      color:#fff;
      font-weight:700;
      cursor:pointer;
    }

    .glassBtn.green{background:rgba(8,120,98,.85)}
    .glassBtn.red{background:rgba(255,90,90,.75)}
    .glassBtn.off{opacity:.6}

    /* Badge */
    #badgeWrap{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      pointer-events:none;
      z-index:15;
    }
    #badge{
      padding:14px 20px;
      border-radius:999px;
      background:rgba(0,0,0,.45);
      font-weight:900;
      opacity:0;
    }
    #badge.show{opacity:1}

    /* Start screen */
    #startScreen{
      position:absolute;
      inset:0;
      z-index:30;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:calc(34px + env(safe-area-inset-top));
      background:rgba(0,0,0,.88);
    }

    .startWrap{
      width:100%;
      max-width:640px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:18px;
    }

    .logoImg{
      width:min(360px, calc(100vw - 140px));
      filter:drop-shadow(0 16px 40px rgba(0,0,0,.6));
    }

    .startCard{
      width:min(560px, calc(100vw - 80px));
      border-radius:28px;
      padding:26px 22px;
      background:rgba(255,255,255,.08);
      backdrop-filter:blur(14px);
      text-align:center;
    }

    .pillBtn{
      width:100%;
      max-width:420px;
      padding:16px;
      margin-top:12px;
      border-radius:999px;
      font-size:20px;
      font-weight:800;
      border:2px solid #fff;
      background:transparent;
      color:#fff;
      cursor:pointer;
    }

    .comingSoon{
      margin-top:14px;
      font-size:17px;
      color:rgba(255,255,255,.6);
    }

    /* Terms modal */
    #termsModal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,.55);
      z-index:50;
    }

    .termsCard{
      width:min(520px, calc(100vw - 44px));
      max-height:80vh;
      overflow:auto;
      padding:18px;
      border-radius:26px;
      background:rgba(255,255,255,.1);
      backdrop-filter:blur(14px);
    }
  </style>
</head>

<body>
<div id="videoContainer">
  <video id="video" autoplay playsinline muted></video>
  <canvas id="canvas"></canvas>

  <div id="hud">
    <div id="counters">
      <div id="repsText">Reps: 0</div>
      <div id="noRepsText">No Reps: 0</div>
    </div>
    <div id="controls">
      <button id="guidesBtn" class="glassBtn green">Guides</button>
      <button id="divisionBtn" class="glassBtn">Division ▾</button>
      <button id="targetMissBtn" class="glassBtn red">Target Miss</button>
      <button id="resetBtn" class="glassBtn">Reset</button>
      <button id="flipBtn" class="glassBtn green">Flip</button>
    </div>
  </div>

  <div id="badgeWrap"><div id="badge">READY</div></div>

  <!-- START SCREEN -->
  <div id="startScreen">
    <div class="startWrap">
      <img src="repchk_logo.png" class="logoImg" alt="REPCHK" />

      <div class="startCard">
        <h1>Select Division</h1>
        <p>Place phone so full body is visible.<br><strong>Rear camera recommended.</strong></p>

        <button class="pillBtn" onclick="startApp('women')">Women</button>
        <button class="pillBtn" onclick="startApp('men')">Men</button>

        <div class="comingSoon">
          Early access version. Not yet available in the App Store.<br>
          <span style="font-size:14px;opacity:.7">
            Install on iPhone: Safari → Share → Add to Home Screen
          </span>
        </div>
      </div>

      <!-- TERMS LINK -->
      <a href="#" id="termsLink"
         style="margin-top:14px;font-size:13px;color:rgba(255,255,255,.55);text-decoration:none">
        Terms & Conditions
      </a>
    </div>
  </div>

  <!-- TERMS MODAL -->
  <div id="termsModal">
    <div class="termsCard">
      <h2>REPCHK – Early Access Terms</h2>
      <p>REPCHK is an early access product provided for testing and evaluation purposes only.</p>
      <p><strong>Ownership</strong><br>
        All software, code, designs, and functionality are the intellectual property of REPCHK.
        You may not copy, modify, reverse engineer, distribute, or commercialise any part of the app.
      </p>
      <p><strong>Use at your own risk</strong><br>
        REPCHK is not an official judging tool and is not affiliated with HYROX or any competition organiser.
      </p>
      <p><strong>No liability</strong><br>
        REPCHK is not responsible for injuries, missed reps, or training decisions made using the app.
      </p>
      <p><strong>Early access status</strong><br>
        Features may change, break, or be removed prior to App Store release.
      </p>
      <button id="closeTermsBtn" class="glassBtn">Close</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

<script>
  const termsLink=document.getElementById("termsLink");
  const termsModal=document.getElementById("termsModal");
  const closeTermsBtn=document.getElementById("closeTermsBtn");

  termsLink.onclick=e=>{
    e.preventDefault();
    termsModal.style.display="flex";
  };
  closeTermsBtn.onclick=()=>termsModal.style.display="none";
  termsModal.onclick=e=>{
    if(e.target===termsModal)termsModal.style.display="none";
  };

  function startApp(d){
    document.getElementById("startScreen").style.display="none";
  }
</script>

</body>
</html>
